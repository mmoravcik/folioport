{% extends 'dashboard/layout.html' %}
{% load staticfiles %}

{% block css %}
    <link href="{% static 'folioport/css/image-picker.css' %}" media="screen" rel="stylesheet" type="text/css" />
    {{ block.super }}
{% endblock %}

{% block content %}
<h3>Please select images you'd like to use</h3>
{{ form.media }}
<form action='' method="POST">
    {{ form }}
    {% csrf_token %}
    <br />
    <input type='submit' value="Save" />
</form>

<a href="{{ next_url }}">Cancel</a>


<form action="{% url 'folioport:dashboard:cms:item-create-redirect' %}">
    <input type='hidden' name='class_name' value='Image' />
    <input type='hidden' name='next' value='{{ request.get_full_path }}' />
    <input type='submit' value='Add image' />
</form>
{% endblock %}


{% block extrascripts %}
{{ block.super }}
<script src="{% static 'folioport/js/lib/image-picker.js' %}" ></script>
<script type='text/javascript'>
// TODO refactor following

function nicerSelectImage() {
    $("#id_image option").each(function() {
        var next_url = "?next={{ request.get_full_path}}";
        $(this).attr("data-img-src", '/media/' + $(this).text());
        var edit_url = "{% url 'folioport:dashboard:cms:item-edit' 'Image' '99999999999' %}";
        var correct_edit_url = edit_url.replace(/99999999999/, $(this).attr('value')) + next_url;

        var delete_url = "{% url 'folioport:dashboard:cms:item-delete' 'Image' '99999999999' %}";
        var correct_delete_url = delete_url.replace(/99999999999/, $(this).attr('value')) + next_url;
        $(this).attr("data-img-label", '<a href="' + correct_edit_url +'">edit</a> &nbsp; <a href="' + correct_delete_url +'">delete</a>' );

    });

    $("#id_image").imagepicker({show_label: true});
}
</script>
{% endblock %}

{% block onbodyload %}

    nicerSelectImage();

{% endblock %}